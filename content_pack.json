{"name":"HAProxy Content Pack for Graylog","description":"This content pack includes following configurations for one click setup:\n\n-  JSON Logging \n    -   HTTP Access/Request/Captured Log\n- Inputs \n- Extractors\n- Streams\n- Dashboards\n    - Requests last 24h (Count)\n    - Requests last 24h (Histogram)\n    - HTTP 4XXs last 24h(Count)\n    - HTTP 4XXs last 24h (Histogram)\n    - HTTP 5XXs last 24h (Count)\n    - HTTP 5XXs last 24h (Histogram)\n    - Map of requests last 24h (World Map)\n    - Top Hourly clients\n    - Backends with retries>0 in 5 days\n    - Frontend connections 7 days\n\n### Setting Up Centralized Logging with Graylog\nCentralized logging is an important component of any production-grade infrastructure.Analyzing log data can help in debugging issues with your deployed applications and services, such as determining the reason for service termination or application crash.\n\nCompatible/Tested with following versions:\n- HA-Proxy version 1.5.19 2016/12/25\n- Graylog 2.4.5\n- Ubuntu 16.04\n- Digitalocean/AWS/GCP/Azure\n","category":"web","inputs":[{"id":"5b488ff66178890566085886","title":"HaProxy log","configuration":{"expand_structured_data":true,"recv_buffer_size":262144,"port":12211,"override_source":null,"force_rdns":false,"allow_override_date":true,"bind_address":"159.89.172.255","store_full_message":false},"static_fields":{"from_haproxy":"true"},"type":"org.graylog2.inputs.syslog.udp.SyslogUDPInput","global":true,"extractors":[{"title":"Empty JSON field","type":"REGEX_REPLACE","cursor_strategy":"COPY","target_field":"message","source_field":"message","configuration":{"replacement":"-","regex":".*"},"converters":[],"condition_type":"NONE","condition_value":"","order":1},{"title":"Reduced message to path","type":"REGEX_REPLACE","cursor_strategy":"COPY","target_field":"message","source_field":"message","configuration":{"replacement":"$1","regex":".*request\": \"(.*?)\".*"},"converters":[],"condition_type":"NONE","condition_value":"","order":2},{"title":"Extract JSON fields","type":"JSON","cursor_strategy":"COPY","target_field":"","source_field":"message","configuration":{"flatten":true,"list_separator":", ","kv_separator":"=","key_prefix":"","key_separator":"_","replace_key_whitespace":false,"key_whitespace_replacement":"_"},"converters":[],"condition_type":"NONE","condition_value":"","order":0},{"title":"HTTP URI from haproxy_httpRequest ","type":"SPLIT_AND_INDEX","cursor_strategy":"COPY","target_field":"haproxy_httpRequestURI","source_field":"haproxy_httpRequest","configuration":{"index":2,"split_by":" "},"converters":[],"condition_type":"NONE","condition_value":"","order":4},{"title":"HTTP Method from haproxy_httpRequest ","type":"SPLIT_AND_INDEX","cursor_strategy":"COPY","target_field":"haproxy_httpRequestMethod","source_field":"haproxy_httpRequest","configuration":{"index":1,"split_by":" "},"converters":[],"condition_type":"NONE","condition_value":"","order":3},{"title":"Empty haproxy_httpRequest Field","type":"REGEX_REPLACE","cursor_strategy":"COPY","target_field":"haproxy_httpRequest","source_field":"haproxy_httpRequest","configuration":{"replacement":"-","regex":".*"},"converters":[],"condition_type":"NONE","condition_value":"","order":6},{"title":"HTTP Request Protocol version from haproxy_httpRequest ","type":"SPLIT_AND_INDEX","cursor_strategy":"COPY","target_field":"haproxy_httpRequestProtocolVersion","source_field":"haproxy_httpRequest","configuration":{"index":3,"split_by":" "},"converters":[],"condition_type":"NONE","condition_value":"","order":5},{"title":"Host Extraction from Captured HTTP Request","type":"SPLIT_AND_INDEX","cursor_strategy":"COPY","target_field":"haproxy_capturedHttpRequestHost","source_field":"haproxy_capturedRequestHeaders","configuration":{"index":1,"split_by":"|"},"converters":[],"condition_type":"NONE","condition_value":"","order":8},{"title":"Removing parenthesis from haproxy_capturedRequestHeaders","type":"REGEX_REPLACE","cursor_strategy":"COPY","target_field":"haproxy_capturedRequestHeaders","source_field":"haproxy_capturedRequestHeaders","configuration":{"regex":"[{}]","replacement":" ","replace_all":true},"converters":[],"condition_type":"NONE","condition_value":"","order":7},{"title":"User Agent Extraction from Captured HTTP Request ","type":"SPLIT_AND_INDEX","cursor_strategy":"COPY","target_field":"haproxy_capturedHttpRequestUserAgent","source_field":"haproxy_capturedRequestHeaders","configuration":{"index":2,"split_by":"|"},"converters":[],"condition_type":"NONE","condition_value":"","order":9},{"title":"HTTP Referer Extraction from Captured HTTP Request","type":"SPLIT_AND_INDEX","cursor_strategy":"COPY","target_field":"haproxy_capturedHttpRequestReferer","source_field":"haproxy_capturedRequestHeaders","configuration":{"index":3,"split_by":"|"},"converters":[],"condition_type":"NONE","condition_value":"","order":10}]}],"streams":[{"id":"5b4d74a1b94b5308d3380192","title":"haproxy HTTP 404s","description":"All requests that were answered with a HTTP 404 by haproxy","disabled":false,"matching_type":"AND","stream_rules":[{"type":"EXACT","field":"haproxy_statusCode","value":"404","inverted":false,"description":""}],"outputs":[],"default_stream":false},{"id":"5b4ca7e19069e6058126b012","title":"haproxy","description":"All requests that were logged into the haproxy log","disabled":false,"matching_type":"AND","stream_rules":[{"type":"EXACT","field":"from_haproxy","value":"true","inverted":false,"description":""},{"type":"EXACT","field":"application_name","value":"haproxy","inverted":false,"description":""}],"outputs":[],"default_stream":false},{"id":"5b4d74bcb94b5308d33801b1","title":"haproxy HTTP 4XXs","description":"All requests that were answered with a HTTP code in the 400 range by haproxy","disabled":false,"matching_type":"AND","stream_rules":[{"type":"GREATER","field":"haproxy_statusCode","value":"399","inverted":false,"description":""},{"type":"SMALLER","field":"haproxy_statusCode","value":"500","inverted":false,"description":""}],"outputs":[],"default_stream":false},{"id":"5b4d74d5b94b5308d33801ce","title":"haproxy HTTP 5XXs","description":"All requests that were answered with a HTTP code in the 500 range by haproxy","disabled":false,"matching_type":"AND","stream_rules":[{"type":"GREATER","field":"haproxy_statusCode","value":"499","inverted":false,"description":""},{"type":"SMALLER","field":"haproxy_statusCode","value":"600","inverted":false,"description":""}],"outputs":[],"default_stream":false}],"outputs":[],"dashboards":[{"title":"HAProxy HTTP Monitoring","description":"Haproxy","dashboard_widgets":[{"description":"Top Hourly backends","type":"QUICKVALUES","cache_time":300,"configuration":{"timerange":{"type":"keyword","keyword":"Last Hour"},"field":"haproxy_backend","show_pie_chart":false,"query":"application_name:haproxy","show_data_table":true},"col":3,"row":6,"height":2,"width":1},{"description":"Top Hourly clients","type":"QUICKVALUES","cache_time":300,"configuration":{"timerange":{"type":"keyword","keyword":"Last Hour"},"field":"haproxy_clientIP","show_pie_chart":false,"query":"application_name:haproxy","show_data_table":true},"col":3,"row":4,"height":2,"width":1},{"description":"Backends with retries>0 in 5 days","type":"QUICKVALUES","cache_time":10,"configuration":{"timerange":{"type":"relative","range":432000},"field":"haproxy_backend","show_pie_chart":true,"query":"application_name:haproxy AND NOT haproxy_retries:0","show_data_table":true},"col":1,"row":6,"height":2,"width":2},{"description":"Frontend connections 7 days","type":"FIELD_CHART","cache_time":3600,"configuration":{"valuetype":"mean","renderer":"line","interpolation":"linear","timerange":{"type":"relative","range":604800},"rangeType":"relative","field":"haproxy_FrontendCurrentConn","query":"application_name:haproxy","interval":"hour","relative":604800},"col":1,"row":8,"height":1,"width":3},{"description":"HTTP 4XXs last 24h","type":"SEARCH_RESULT_CHART","cache_time":10,"configuration":{"timerange":{"type":"relative","range":864000},"interval":"hour","stream_id":"5b4d74bcb94b5308d33801b1","query":""},"col":2,"row":2,"height":1,"width":2},{"description":"Requests last 24h","type":"STREAM_SEARCH_RESULT_COUNT","cache_time":10,"configuration":{"timerange":{"type":"relative","range":86400},"lower_is_better":false,"stream_id":"5b4ca7e19069e6058126b012","trend":false,"query":"*"},"col":1,"row":1,"height":1,"width":1},{"description":"Requests last 24h","type":"SEARCH_RESULT_CHART","cache_time":10,"configuration":{"timerange":{"type":"relative","range":86400},"interval":"hour","stream_id":"5b4ca7e19069e6058126b012","query":""},"col":2,"row":1,"height":1,"width":2},{"description":"HTTP 4XXs last 24h","type":"STREAM_SEARCH_RESULT_COUNT","cache_time":10,"configuration":{"timerange":{"type":"relative","range":86400},"lower_is_better":false,"stream_id":"5b4d74bcb94b5308d33801b1","trend":false,"query":"*"},"col":1,"row":2,"height":1,"width":1},{"description":"HTTP 5XXs last 24h","type":"STREAM_SEARCH_RESULT_COUNT","cache_time":10,"configuration":{"timerange":{"type":"relative","range":86400000},"lower_is_better":false,"stream_id":"5b4d74d5b94b5308d33801ce","trend":false,"query":""},"col":1,"row":3,"height":1,"width":1},{"description":"HTTP 5XXs last 24h","type":"SEARCH_RESULT_CHART","cache_time":10,"configuration":{"timerange":{"type":"relative","range":86400},"interval":"minute","stream_id":"5b4d74d5b94b5308d33801ce","query":""},"col":2,"row":3,"height":1,"width":2},{"description":"Map of requests last 24h","type":"org.graylog.plugins.map.widget.strategy.MapWidgetStrategy","cache_time":10,"configuration":{"timerange":{"type":"relative","range":86400},"field":"haproxy_clientIP_geolocation","query":"gl2_source_input:5b488ff66178890566085886"},"col":1,"row":4,"height":2,"width":2}]}],"grok_patterns":[],"lookup_tables":[],"lookup_caches":[],"lookup_data_adapters":[]}